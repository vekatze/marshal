import {
  binary-builder.entity,
  binary-builder.scene {
    append-binary,
    append-float64-big-endian,
    append-int16-big-endian,
    append-int32-big-endian,
    append-int64-big-endian,
    append-int8,
    append-text,
  },
  core.binary {binary, binary-length},
  core.text {text-byte-length},
  this.rule.put-handle {Encode-Handle, encode-handle},
}

define put-int8(h: &encode-handle, x: int8): unit {
  tie Encode-Handle of {buffer} = h in
  append-int8(buffer, x)
}

define put-int16(h: &encode-handle, x: int16): unit {
  tie Encode-Handle of {buffer} = h in
  append-int16-big-endian(buffer, x)
}

define put-int32(h: &encode-handle, x: int32): unit {
  tie Encode-Handle of {buffer} = h in
  append-int32-big-endian(buffer, x)
}

define put-int64(h: &encode-handle, x: int64): unit {
  tie Encode-Handle of {buffer} = h in
  append-int64-big-endian(buffer, x)
}

define put-float64(h: &encode-handle, x: float64): unit {
  tie Encode-Handle of {buffer} = h in
  append-float64-big-endian(buffer, x)
}

define put-binary(h: &encode-handle, x: &binary): unit {
  tie Encode-Handle of {buffer} = h in
  let len = binary-length(x) in
  put-int64(h, len);
  append-binary(buffer, x)
}

define put-text(h: &encode-handle, x: &text): unit {
  tie Encode-Handle of {buffer} = h in
  let len = text-byte-length(x) in
  put-int64(h, len);
  append-text(buffer, x)
}

define get(h: encode-handle): binary {
  let Encode-Handle of {buffer} = h in
  binary-builder.entity.get(buffer)
}
