import {
  core.c-int {from-c-int},
  core.file.mode {default-file-mode},
  core.foreign {O_CREAT},
  core.int.show {show-int},
  core.list {for},
  core.system {get-error-message},
  this.move.class.int64 {int64-sero},
  this.move.class.list {list-sero},
  this.move.decode {decode-file},
  this.move.encode {encode-file},
  this.rule.sero {sero},
}

inline _list-int-sero: sero(list(int), list(int)) {
  list-sero(int64-sero)
}

define zen(): unit {
  printf("O_CREAT: {}\n", [show-int(from-c-int(O_CREAT))]);
  printf("mode: {}\n", [show-int(from-c-int(core.file.mode.interpret(default-file-mode)))]);
  pin value: list(int) = [1, 2, 3, 42342, 5, 6] in
  let path = "test.bin" in
  let _ = encode-file(_list-int-sero, value, 10, path) in
  let v = decode-file(_list-int-sero, path) in
  match v {
  | Left(e) =>
    printf("left: {}\n", [get-error-message(e)])
  | Right(v) =>
    print("right\n");
    match v {
    | Left(_) =>
      print("right-left")
    | Right(xs) =>
      for(xs, function (x) {
        printf("right-right: {}\n", [show-int(x)])
      })
    }
  }
}

define main(): unit {
  zen()
}
